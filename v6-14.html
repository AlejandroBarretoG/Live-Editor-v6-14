<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor Visual - v6.13: UI Modularizada</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-100 font-sans">

    <div id="main-content-wrapper">
        <div class="container mx-auto p-8 space-y-6 bg-white my-8 rounded-lg shadow-lg" data-label="Contenedor Principal">
            <header class="border-b pb-4 flex justify-between items-center" style="background-color: rgb(59, 130, 246); background-image: linear-gradient(45deg, rgba(236, 72, 153, 0.5) 0%, rgba(239, 68, 68, 0.5) 100%), conic-gradient(at 25% 75%, rgb(255, 235, 59) 0%, rgb(255, 87, 34) 50%, rgb(156, 39, 176) 100%); background-blend-mode: overlay, normal;" data-label="Cabecera">
                <div>
                    <h1 class="text-4xl font-bold text-gray-800">Página de Demostración</h1>
                    <p class="text-gray-600 mt-2">Usa los controles del panel para empezar a inspeccionar.</p>
                </div>
            </header>
            <main class="grid grid-cols-1 md:grid-cols-3 gap-6" data-label="Cuerpo Principal">
                <div class="md:col-span-2 bg-gray-50 p-6 rounded-lg relative" data-label="Artículo Principal">
                    <span class="absolute top-0 right-0 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-bl-lg">Nuevo</span>
                    <h2 class="text-2xl font-semibold text-gray-700">Artículo Principal</h2>
                    <p id="parrafo-inicial" class="mt-4 text-gray-600">Este es el párrafo principal. Haz <strong>clic</strong> para inspeccionar o <strong>Ctrl+Clic</strong> para añadir a la lista del LLM. Usa <strong>Ctrl+Q</strong> para guardar un widget.</p>
                    <a href="#" class="text-blue-500 hover:underline">Este es un enlace de prueba.</a>
                </div>
                <aside class="bg-blue-50 p-6 rounded-lg" data-label="Barra Lateral">
                    <h3 class="text-xl font-semibold text-blue-800">Barra Lateral</h3>
                    <ul id="lista-elementos" class="mt-4 space-y-2 list-disc list-inside text-blue-700">
                        <li>Elemento de lista 1</li>
                        <li>Elemento de lista 2</li>
                        <li>Elemento de lista 3</li>
                    </ul>
                    <button class="mt-6 w-full bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-300">Botón de Acción</button>
                </aside>
                <div class="md:col-span-3 bg-white p-6 rounded-lg shadow mt-6" data-label="Contenedor Tabla">
                    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Tabla de Datos</h2>
                    <table id="tabla-demostracion" class="w-full text-sm text-left text-gray-500 table-fixed border-collapse border border-slate-400">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 border border-slate-300">Producto</th>
                                <th scope="col" class="px-6 py-3 border border-slate-300">Color</th>
                                <th scope="col" class="px-6 py-3 border border-slate-300">Categoría</th>
                                <th scope="col" class="px-6 py-3 border border-slate-300">Precio</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="bg-white">
                                <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap border border-slate-300">Apple MacBook Pro 17"</th>
                                <td class="px-6 py-4 border border-slate-300">Silver</td>
                                <td class="px-6 py-4 border border-slate-300">Laptop</td>
                                <td class="px-6 py-4 border border-slate-300">$2999</td>
                            </tr>
                            <tr class="bg-white">
                                <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap border border-slate-300">Microsoft Surface Pro</th>
                                <td class="px-6 py-4 border border-slate-300">White</td>
                                <td class="px-6 py-4 border border-slate-300">Laptop PC</td>
                                <td class="px-6 py-4 border border-slate-300">$1999</td>
                            </tr>
                            <tr class="bg-white">
                                <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap border border-slate-300">Magic Mouse 2</th>
                                <td class="px-6 py-4 border border-slate-300">Black</td>
                                <td class="px-6 py-4 border border-slate-300">Accessories</td>
                                <td class="px-6 py-4 border border-slate-300">$99</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="md:col-span-3 bg-gray-50 p-6 rounded-lg mt-6" data-label="Ejemplo Grid">
                    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Ejemplo de Grid Layout</h2>
                    <div class="grid grid-cols-4 grid-rows-4 gap-4 text-white font-bold text-center">
                        <div class="col-span-3 p-4 bg-red-500 rounded-md flex items-center justify-center">Bloque 1</div>
                        <div class="p-4 bg-red-500 rounded-md flex items-center justify-center">Bloque 2</div>
                        <div class="col-span-2 row-span-2 p-4 bg-yellow-500 rounded-md flex items-center justify-center">Bloque 3</div>
                        <div class="col-span-2 p-4 bg-purple-500 rounded-md flex items-center justify-center">Bloque 4</div>
                        <div class="col-span-2 p-4 bg-purple-500 rounded-md flex items-center justify-center">Bloque 5</div>
                        <div class="p-4 bg-teal-500 rounded-md flex items-center justify-center">Bloque 6</div>
                        <div class="col-span-2 p-4 bg-teal-500 rounded-md flex items-center justify-center">Bloque 7</div>
                        <div class="p-4 bg-teal-500 rounded-md flex items-center justify-center">Bloque 8</div>
                    </div>
                </div>
                <div class="md:col-span-3 bg-white p-6 rounded-lg shadow mt-6" data-label="Ejemplo Flexbox">
                    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Ejemplo de Flexbox Layout</h2>
                    <div class="flex flex-col gap-4 text-white font-bold text-center">
                        <div class="flex gap-4 w-full" style="height: 60px;">
                            <div class="w-1/5 p-4 bg-blue-500 rounded-lg flex items-center justify-center">Col 1</div>
                            <div class="w-1/5 p-4 bg-blue-500 rounded-lg flex items-center justify-center">Col 2</div>
                            <div class="w-1/5 p-4 bg-blue-500 rounded-lg flex items-center justify-center">Col 3</div>
                            <div class="w-1/5 p-4 bg-blue-500 rounded-lg flex items-center justify-center">Col 4</div>
                            <div class="w-1/5 p-4 bg-blue-500 rounded-lg flex items-center justify-center">Col 5</div>
                        </div>
                        <div class="flex gap-4 w-full" style="height: 60px;">
                            <div class="w-1/4 p-4 bg-green-500 rounded-lg flex items-center justify-center">Col 6</div>
                            <div class="w-1/4 p-4 bg-green-500 rounded-lg flex items-center justify-center">Col 7</div>
                            <div class="w-1/4 p-4 bg-green-500 rounded-lg flex items-center justify-center">Col 8</div>
                            <div class="w-1/4 p-4 bg-green-500 rounded-lg flex items-center justify-center">Col 9</div>
                        </div>
                        <div class="flex gap-4 w-full" style="height: 60px;">
                            <div class="w-1/4 p-4 bg-red-500 rounded-lg flex items-center justify-center">Col 10</div>
                            <div class="w-1/2 p-4 bg-red-500 rounded-lg flex items-center justify-center">Col 11</div>
                            <div class="w-1/4 p-4 bg-red-500 rounded-lg flex items-center justify-center">Col 12</div>
                        </div>
                        <div class="flex gap-4 w-full" style="height: 60px;">
                            <div class="w-1/2 p-4 bg-orange-500 rounded-lg flex items-center justify-center">Col 13</div>
                            <div class="w-1/2 p-4 bg-orange-500 rounded-lg flex items-center justify-center">Col 14</div>
                        </div>
                        <div class="flex gap-4 w-full" style="height: 60px;">
                            <div class="w-full p-4 bg-purple-500 rounded-lg flex items-center justify-center">Col 15</div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="script_manager.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.addEventListener('modulesLoaded', () => {
                // =================================================================
                // ===             INICIALIZACIÓN DEL ORQUESTADOR                ===
                // =================================================================

                window.EditorTools.UIManager.init();

                const mainContentWrapper = document.getElementById('main-content-wrapper');
                const treeViewRoot = document.getElementById('tree-view-root');
                const panelCodigo = document.getElementById('panel-codigo');
                const contenidoCodigo = document.getElementById('contenido-codigo');
                const analysisContainer = document.getElementById('element-analysis-in-code');

                const historyManager = new window.EditorTools.HistoryManager(mainContentWrapper, reiniciarTodo);
                const treeViewManager = new window.EditorTools.DomTreeViewManager(treeViewRoot, mainContentWrapper);
                const propertiesPanel = new window.EditorTools.PropertiesPanelManager({
                    panelCodigo: panelCodigo,
                    contenidoCodigo: contenidoCodigo,
                    analysisContainer: analysisContainer,
                    codigoHtmlToggle: document.getElementById('codigo-html-toggle'),
                    elementAnalysisToggle: document.getElementById('element-analysis-toggle')
                });
                
                const inspectorCore = new window.EditorTools.InspectorCore({
                    panelCodigo: panelCodigo,
                    treeViewManager: treeViewManager,
                    mostrarCodigoEnPanelFn: propertiesPanel.show.bind(propertiesPanel),
                    historyManager: historyManager,
                    propertiesPanel: propertiesPanel
                });
                
                const editorToolsManager = new window.EditorTools.EditorToolsManager({
                    mainContentWrapper: mainContentWrapper,
                    historyManager: historyManager,
                    getInspectorState: () => inspectorCore.isInspectorActive(),
                    resetInspector: () => inspectorCore.reiniciarInspeccionSimple()
                });

                function reiniciarTodo() {
                    inspectorCore.reiniciarInspeccionSimple();
                    if (treeViewManager) treeViewManager.rebuildTree();
                }

                window.EditorTools.initPanels();
                treeViewManager.init();
                propertiesPanel.init();
                inspectorCore.init();
                editorToolsManager.init();
                historyManager.saveState();

                document.addEventListener('treeNodeClicked', e => {
                    if (inspectorCore.isInspectorActive()) {
                        const { inspectorId } = e.detail;
                        const targetElement = document.querySelector(`[data-inspector-id="${inspectorId}"]`);
                        targetElement?.dispatchEvent(new MouseEvent('click', { bubbles: true, cancelable: true, view: window }));
                    }
                });
            });
        });
    </script>
</body>
</html>
